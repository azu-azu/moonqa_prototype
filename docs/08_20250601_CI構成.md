🗓️ 2025/06/01 \[Sunday] 08:50

# 🌕 Phase 5 / Task 0: CI構成の設計

## 🌙 Cause Summary

ログと自動テストの整備は完了しており、次に必要なのは「品質を継続的に守るための仕組み＝CI（継続的インテグレーション）」の導入である。
目的：CIで自動テストと品質管理を仕組み化する

---

## 🌙 Possible Causes

* 検索テスト（`test_qa_search.py`）は API を叩くため、CIではコストとリスクがある
* CIでは構造ログ (`qa_log.jsonl`) の整合性チェックのみに絞る構成が望ましい
* `manual_` 系ファイルは全て手動確認用であり、CI対象に含めるべきではない
* `.env` に依存している部分があるため、**ダミー環境変数の定義**が `.env.example` として必要

---

## 🌙 Structural Note

* CI設計の初期段階では、**「壊さない」ことが最重要**。
* 既存の構造（分離されたログ出力、責務が明確なテスト構成）を活かす形で、**コストゼロかつ堅牢なCI構成**を優先。
* 検索精度やAPI連携はローカルテストで担保、CIは「構造の安全」を守るシンプルな役割に限定。

---

## Done（Phase 5 / Task 0）

🗓️ 2025/06/01 \[Sunday] 16:30-16:50

* CI導入の初期設計（GitHub Actionsベース）を完了
* `.github/workflows/ci.yml` を作成して `pytest` 実行の自動化ルートを確保

  * CIでは `pytest -k test_log_entry_structure` のみ実行
* `.env.example` を **実際の `.env` に合わせて最小限で作成**

  * `OPENAI_API_KEY`, `OPENAI_MODEL` のみ（※CI実行には不要だが構造として記録）
* `.pytest.ini` を追加して **`manual_*.py` をpytest対象から除外**
* `logs/` はすでに `.gitignore` 済みで安全確認完了
* すべてのファイルを commit ＆ push 済み（構造記録対応）

---

## 🌱 気づき・改善ポイント

* `.env.example` は実行には不要だが、**構造として残す意味がある**（今後のAPI再導入時の備え）
* `pytest.ini` のような「小さい設定ファイル」でも、**テストの対象範囲を明示できる影響力が大きい**
* CIは「回すこと」ではなく、「何を守るか」を明示する場だと再確認した

---

## 🧭 今の状態

* CIは OpenAI API を一切叩かず、**コストゼロで実行される構成**になった
* 実行対象は `test_log_entry_structure()` のみ
* ログ構造の破損・欠落が即検出される状態になり、**安心して開発が進められる地盤が整った**

---

# 🌕 Phase 5 / Task 1: CI内でのログ出力バリデーション

---

## 🌙 Cause Summary

CIでは `pytest` が通るようになったが、**実際に出力されるログ（qa\_log.jsonl）が壊れていないか？** を誰も見ていない。
構造ログが分析や可視化の基盤になる以上、**CI上でも構造バリデーションが必要**。

---

## 🌙 Possible Causes

* `qa_log.jsonl` が空／壊れていても、pytestは通る状態
* 人間が tail + jq で見ていた構造チェックが、自動では行われていない
* 今後CIで可視化・分析基盤とつなげるなら、「ログの正しさ」こそ生命線

---

## 🌙 Structural Note

* これは**ログ出力の“構造的信頼性”を担保するためのCI強化**タスク
* `.pytest.skip()` により、ログが存在しない場合も安全にテストがスキップされ、CIが不必要にfailしない構造を実現
