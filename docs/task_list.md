# 🌌 MoonQAプロジェクト構造ガイド

---

## 🌕 フェーズ一覧と現在地

| フェーズ                     | 目的                                | ステータス    |
| ------------------------ | --------------------------------- | -------- |
| **Phase 1: ベース構築**       | 開発基盤を整える（ディレクトリ設計、`.env`管理）       | ✅ 完了済み   |
| **Phase 2: テスト整備**       | 自動テストの枠組みを構築、基本精度を担保              | ✅ 完了済み   |
| **Phase 3: 精度＆制御強化**     | `target_pdf`やスコアしきい値で検索の精度と制御性を向上 | ✅ 完了済み   |
| **Phase 4: ログと可視化**      | QA結果をログ出力し、後分析しやすくする              | ✅ 完了済み   |
| **Phase 5: CI対応**        | GitHub Actionsなどで自動テスト運用を整備       | ✅ 完了済み   |
| **Phase 6: UX連携／Agent化** | UIやBot化でユーザー体験向上／対話型エージェントへ進化     | 🧭 将来的段階 |

---

## 🌕 フェーズ別タスクログ

---

### 🌙 Phase 1: ベース構築（完了）

* ディレクトリ設計、`.env`管理
* `main.py` を使うか／削除するか検討

---

### 🌙 Phase 2: テスト整備（完了）

#### Task 1: `main.py` の役割を明確化

* \[☑️] 使用されていないなら削除
* [ ] 使用するなら目的を `README` に明記

#### Task 2: `scripts/` ディレクトリの整理

* \[☑️] 各スクリプトの役割をコメントで記述
* \[☑️] 本番用／テスト用の区分を `README.md` に明示

#### Task 3: `settings.py` の意図を明文化

* \[☑️] `.env`と`settings.py`の役割分担を整理
* \[☑️] 将来的な拡張に備えて構造を設計
* \[☑️] 「設定変更場所の案内」を `README` に追加

#### Task 4: 自動テストの整備

* \[☑️] テスト網羅状況を確認（7件のパス実績）
* \[☑️] `pytest` での実行が安定することを確認

---

### 🌙 Phase 3: 精度＆制御強化（完了）

* \[☑️] `target_pdf` 切り替え対応
* \[☑️] 類似度スコアのしきい値導入

---

### 🌙 Phase 4: ログと可視化（完了）

#### Task 1: スコアと出典のログ構造設計

* \[☑️] JSON形式でログ設計（source, page 含む）
* \[☑️] 出力ディレクトリ：`logs/qa_test_results.json`
* \[☑️] 記録項目：質問・PDF・スコア・チャンク数・回答文など

#### Task 2: ログ出力機能の追加

* \[☑️] `--log-output` オプションで出力切替
* \[☑️] append形式で質問ごとの記録を残す
* \[☑️] 出力内容の正確性をテストで確認済み

#### Task 3: ログ品質チェックと分析基盤

* \[☑️] JSONとして構造が正しいか確認
* \[☑️] 出力内容（ページ数・ファイル名等）チェック
* \[☑️] UI連携を想定した項目設計（例：query\_id, timestamp）

---

## 🌙 Phase 5（CI対応）:CIで自動テストと品質管理を仕組み化する
🗓️ 2025/06/01 \[Sunday] 09:15 時点

### Task 0: CI構成の設計（準備タスク）

* [☑️] `pytest` 実行対象は `test_log_entry_structure.py` のみに限定
* [☑️] `manual_*.py` はCI対象から除外（出力ノイズ対策）
* [☑️] `.env.example` を用意（CIに必要な環境変数だけ定義）
* [☑️] `.github/workflows/ci.yml` を新規作成（poetry + pytest実行）
* [☑️] ログ出力先は `logs/qa_log.jsonl` に統一（`.gitignore`対象）

---

### 🌙 Phase 6: UX連携／Agent化（未着手）

* 検討キーワード：

  * UI連携（Web／Streamlitなど）
  * Bot化（RAGエージェント）
  * 対話フロー／プロンプト最適化

---

## 🌓 Appendix（今後追加すると良さそうな構造）

### 🔍 検索しやすさ向上のために

* 各タスクに `#tag` をつけておくと、grep／検索が便利になる
  例：`#ci`, `#log`, `#test` など

### ⏱️ 各タスクの所要時間・実施日を入れておくと、リソース見積に役立つ

---

